# Проект "Автономная посадка дрона на провод ЛЭП и возврат в домашнюю точку"
## FLY WITHOUT ME (alphaversion1.0)

Целью проекта является разработка системы автономной посадки БПЛА на провода ЛЭП, автоматизирующей мониторинг и обслуживание линий электропередач, обеспечивая безопасное приземление дрона на провод и возвращение в точку взлёта <br> Ожидаемый продуктовый результат - система автономной посадки "Fly Without Me", решение которой включает в себя использование лидара и тепловизора для точного позиционирования, а также расчёт маршрута полёта и веб-интерфейс для управления


## Описание аппаратной части

Предполагается, что на дроне установлены

- Лазер LiDAR (в сборке установлены технические параметры Velabit Velodyne LiDAR <br>([технические характеристики](https://agmtrd.com/product/velabit)) , позиционные параметры установки относительно дрона<br>(xyz="0 0 -0.02" rpy="1.571 1.571 0"))
  
- Тепловизор (в сборке тепловизор имитируется камерой с монохромным форматом)
  


## Описание программной части

Описание программной части: в чём заключается решение и как оно работает

### Решение состоит из двух блоков :
1. Блок веб-интерфейса 
   + Программа запуска веб-интерфейса (app.py)
   + файл index.html
   + файл script.js
   + файл style.css

2. Программный блок
   - Основная программа (fwm.py), 
   - Программа возвращения в точку старта (homecoming.py) 
   - *+ программа тестовой миссии (TESTTASKWAIT5SEC.py)

### Блок веб-интерфейса
Концептуальное описание блока:

#### Фаза 1. Запуск сервера

- При запуске app.py создаётся Flask-приложение с Socket.IO 

- Активируется обработка через eventlet

#### Фаза 2. Подключение к ROS

Запускается поток ROSListener:

   - Подключается к ROS как нода web_interface

   - Подписывается на топик /rosout_agg (логирование ROS)

   - Выводятся сообщения только от ноды /autonomous_flight

#### Фаза 3. Работа веб-интерфейса

- При загрузке страницы выводится HTML-интерфейс (index.html)

- При подключении WebSocket передаётся изображение маршрута (flight_route.png)

#### Фаза 4. Управление процессами дрона

При нажатии кнопки "Запуск" запускается событие start_mission:

- Запускается скрипт fwm.py (автономный полёт) как отдельный процесс

- Вывод процесса передаётся в веб-интерфейс в реальном времени

При нажатии кнопки "Экстренный возврат" запускается событие emergency_home:

- Останавливаются все активные процессы

- Запускается скрипт homecoming.py (возврат на точку старта)

### Программный блок
Концептуальное описание блока:
#### Фаза 1. Инициализация ROS-ноды

Программа запускается как нода autonomous_flight в ROS

Создаёт прокси для сервисов Clover Platform:

- get_telemetry (получение телеметрии)

- navigate (управление движением)

- land (посадка)

#### Фаза 2. Настройка системы координат (TF)

- Создаёт статические преобразования координат для датчиков (положение датчиков относительно дрона):

- Публикует преобразования через StaticTransformBroadcaster

#### Фаза 3. Обработка сенсорных данных

Лидар (Velodyne):

- Подписка на топик /velodyne_points

- Преобразование облака точек в систему aruco_map

- Алгоритм обнаружения провода (detect_wirep)

Тепловая камера:

- Подписка на топик /thermal_camera/points

- Фильтрация точек по температуре (THERMAL_THRESHOLD)

- Преобразование координат в aruco_map

#### Фаза 4. Планирование миссии

 - Генерация контрольных точек маршрута (generate_checkpoints)

- Визуализация маршрута:

  - Создание графика через matplotlib

  - Сохранение в /projectfwm/newroutes/flight_route.png

Последовательность выполнения:

Взлет → Перелёт к первой точке маршрута → Активация сенсоров → 
Сбор данных → Определение точки посадки → Посадка → Выполнение послепосадочных задач

#### Фаза 5. Полёт и навигация

- Алгоритм перемещения между точками (navigate_wait)

- Система позиционирования над проводом (landing_sequence)

- Коррекция по данным лидара (detect_wirep)

- Удержание позиции (hold_position)

#### Фаза 6. Послепосадочная последовательность

Запуск послепосадочных процессов:

- TESTTASKWAIT5SEC.py (имитация задачи)

- homecoming.py (возврат в точку взлёта)

#### Взаимодействие с веб-интерфейсом

- Логирование в формате [FWM] сообщение → stdout

- Передача в веб-интерфейс маршрута flight_route.png через Flask

- Запуск/остановка программы через Socket.IO (управляется из app.py)

## Стек технологий
- Frontend : HTML , CSS
- Backend : JavaScript , Python
- Библиотеки :
  - ROS-библиотеки : 
      - Основные ROS-клиенты и инструменты : <br> ros-noetic-rospy (Python-клиент для ROS) , python3-rosdep (инструмент управления системными зависимостями) , ros-noetic-rosgraph-msgs (сообщения для внутренней диагностики ROS)
      - Системы координат и преобразования (TF) : <br> ros-noetic-tf2-ros (основной инструмент TF2 для ROS)  , python3-tf2-msgs (Python-интерфейс для сообщений TF2) , ros-noetic-tf2-sensor-msgs (преобразования для данных сенсоров)
      - ROS-сообщения для различных данных : <br> ros-noetic-sensor-msgs (форматы данных сенсоров: камеры, IMU, лазеры) , ros-noetic-geometry-msgs (геометрические примитивы: точки, векторы, Pose) , ros-noetic-nav-msgs (сообщения для навигации) , ros-noetic-std-srvs (стандартные сервисные запросы/ответы)
      - Взаимодействия с ROS через веб-интерфейс : <br> ros-noetic-rosbridge-server (WebSocket для доступа к ROS из браузера) , ros-noetic-rosauth (аутентификация для rosbridge-server)
      - Библиотеки COEX Clover : <br> ros-noetic-clover (пакет для работы с квадрокоптером Clover)

  - Python-библиотеки : numpy (работа с массивами данных , математические операции для анализа распределения точек лидара, фильтрация данных для выделения точек в зоне провода , генерация контрольных точек) , matplotlib (построение маршрута с сохранением в PNG), eventlet (асинхронные сетевые операции в веб-интерфейсе) , flask (веб-фреймворк для интерфейса управления) , flask-socketio (интеграция WebSocket для Flask)
- Инструменты : Gazebo COEX Clover , RViz , технологии тепловизионного сканирования (инфракрасное сканирование) , LiDAR

## Демо-видео работы проекта в COEX Clover 

https://github.com/user-attachments/assets/e80a603f-f477-4756-8346-c7ea6e7c6ed1

## Ссылки на презентацию проекта и дополнительные демо-видео
Презентация проекта : https://docs.google.com/presentation/d/1Kt_c-mh5aDtu3cgAsipNGJ6uufmu0aIW/edit?usp=sharing&ouid=110369902751486092263&rtpof=true&sd=true<br>
Дополнительные демо-видео (Google Диск) : https://drive.google.com/drive/folders/1NdRvFrYiuvG3dUTHJ8tiSM03M0uV2cbG?usp=sharing <br>






